/*Proxy -> Match and Replace -> Http match and replace rules -> Add -> Bambda Mode -> replace "return requestResponse.request();" code with following code -> Ok 
===============================================================================================================================================================*/

HttpRequest request = requestResponse.request();
String cookieHeader = request.headerValue("Cookie");

if (cookieHeader == null) 
    return request;

// List of allowed cookie names
Set<String> allowedCookies = Set.of("sprout-session");

String updatedCookie = Arrays.stream(cookieHeader.split(";"))
    .map(String::trim)
    .filter(c -> {
        // Split into name=value
        int eqIndex = c.indexOf('=');
        if (eqIndex == -1) return false;
        String name = c.substring(0, eqIndex).trim();
        return allowedCookies.contains(name);
    })
    .collect(Collectors.joining("; "));

// Re-write the following based on your requirement to remove specific headers from the request
request = request.withRemovedHeader("X-Datadog-Origin");
request = request.withRemovedHeader("X-Datadog-Parent-Id");
request = request.withRemovedHeader("X-Datadog-Trace-Id");
request = request.withRemovedHeader("X-Datadog-Sampling-Priority");
request = request.withRemovedHeader("Traceparent");
request = request.withRemovedHeader("X-Requested-With");
request = request.withRemovedHeader("Sec-Ch-Ua");
request = request.withRemovedHeader("Sec-Ch-Ua-Mobile");
request = request.withRemovedHeader("Sec-Ch-Ua-Platform");
request = request.withRemovedHeader("Sec-Fetch-Site");
request = request.withRemovedHeader("Sec-Fetch-Mode");
request = request.withRemovedHeader("Sec-Fetch-Dest");
request = request.withRemovedHeader("Priority");
request = request.withRemovedHeader("Te");

return request.withUpdatedHeader("Cookie", updatedCookie);
